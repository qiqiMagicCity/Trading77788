
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>全部交易记录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="top">
    <a href="index.html" class="details" style="margin-right:20px;">← 返回</a>
    <span style="font-size:18px;">全部交易记录</span>
  </header>
  <table id="all-trades" class="table"></table>

  <dialog id="editDialog">
    <form method="dialog" id="editForm">
      <h3>编辑交易</h3>
      <label>交易日期: <input type="date" id="ed-date" required></label><br>
      <label>股票代码: <input type="text" id="ed-symbol" required></label><br>
      <label>交易方向:
        <select id="ed-side">
          <option value="BUY">买</option>
          <option value="SELL">卖</option>
          <option value="SHORT">做空</option>
          <option value="COVER">回补</option>
        </select>
      </label><br>
      <label>数量: <input type="number" id="ed-qty" min="1" required></label><br>
      <label>单价: <input type="number" id="ed-price" step="0.01" min="0" required></label><br>
      <menu>
        <button value="cancel">取消</button>
        <button id="ed-submit" value="default">保存</button>
      </menu>
    </form>
  </dialog>

  <script>
    let trades = JSON.parse(localStorage.getItem('trades')||'[]');
    function save(){ localStorage.setItem('trades', JSON.stringify(trades)); }

    function render(){
      const tbl=document.getElementById('all-trades');
      const head=['日期','代码','方向','单价','数量','盈亏','操作'];
      tbl.innerHTML='<tr>'+head.map(h=>`<th>${h}</th>`).join('')+'</tr>';
      trades.forEach((t,i)=>{
        const plCls=t.pl>0?'green':t.pl<0?'red':'white';
        tbl.insertAdjacentHTML('beforeend',`
          <tr>
            <td>${t.date}</td><td>${t.symbol}</td><td>${t.side}</td>
            <td>${t.price.toFixed(2)}</td><td>${t.qty}</td>
            <td class="${plCls}">${t.pl.toFixed(2)}</td>
            <td>
              <a href="#" onclick="editTrade(${i});return false;">编辑</a> |
              <a href="#" onclick="deleteTrade(${i});return false;">删除</a>
            </td>
          </tr>`);
      });
    }

    function deleteTrade(idx){
      if(!confirm('确定删除该交易?')) return;
      trades.splice(idx,1);
      save();
      render();
    }

    function editTrade(idx){
      const dlg=document.getElementById('editDialog');
      const form=document.getElementById('editForm');
      const t=trades[idx];
      document.getElementById('ed-date').value=t.date;
      document.getElementById('ed-symbol').value=t.symbol;
      document.getElementById('ed-side').value=t.side;
      document.getElementById('ed-qty').value=t.qty;
      document.getElementById('ed-price').value=t.price;
      dlg.showModal();
      form.onsubmit=e=>{
        e.preventDefault();
        t.date=document.getElementById('ed-date').value;
        t.symbol=document.getElementById('ed-symbol').value.trim().toUpperCase();
        t.side=document.getElementById('ed-side').value.toUpperCase();
        t.qty=parseInt(document.getElementById('ed-qty').value,10);
        t.price=parseFloat(document.getElementById('ed-price').value);
        save();
        dlg.close();
        render();
      };
    }

    render();
  </script>
</body>
</html>
